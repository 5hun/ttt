<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Task Time Tracker</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        h1 {
            margin: 0;
        }

        #timers {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: min(100%, 500px);
        }

        .timer {
            display: grid;
            grid-template-columns: 1fr auto 2.5rem;
            align-items: center;
            gap: 0.5rem;
            background: #fff;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);
        }

        .timer button.toggle {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            text-align: left;
        }

        .timer button.toggle.running {
            background: #00b894;
            color: #fff;
        }

        .timer button.toggle:not(.running) {
            background: #dfe6e9;
            color: #2d3436;
        }

        .timer span.time {
            font-variant-numeric: tabular-nums;
            font-size: 1.1rem;
            cursor: pointer;
            user-select: none;
            text-align: right;
        }

        .timer button.delete {
            background: transparent;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            color: #636e72;
        }

        form#addForm {
            display: flex;
            gap: 0.5rem;
            width: min(100%, 500px);
        }

        form#addForm input[type="text"] {
            flex: 1;
            padding: 0.5rem;
            font-size: 1rem;
            border: 1px solid #b2bec3;
            border-radius: 0.5rem;
        }

        form#addForm button {
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            border: none;
            border-radius: 0.5rem;
            background: #0984e3;
            color: #fff;
            cursor: pointer;
        }

        #resetAll {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: none;
            border-radius: 0.5rem;
            background: #d63031;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Task Time Tracker</h1>

    <div id="timers"></div>

    <form id="addForm">
        <input id="newLabel" type="text" placeholder="Label" required>
        <button type="submit">Add</button>
    </form>

    <button id="resetAll">Reset All</button>

    <script>
        (function () {
            const timersEl = document.getElementById('timers');
            const addForm = document.getElementById('addForm');
            const newLabelInput = document.getElementById('newLabel');
            const resetAllBtn = document.getElementById('resetAll');

            /** Timer objects:
             *   { id, label, elapsed, running, lastStart }
             */
            let timers = loadTimers();

            // ------------------ utility ------------------
            function saveTimers() {
                localStorage.setItem('multiTimers', JSON.stringify(timers));
            }

            function loadTimers() {
                try {
                    const d = JSON.parse(localStorage.getItem('multiTimers'));
                    if (Array.isArray(d)) return d;
                } catch (_) { }
                return [];
            }

            function formatMs(ms) {
                const total = Math.floor(ms / 1000);
                const hh = String(Math.floor(total / 3600)).padStart(2, '0');
                const mm = String(Math.floor((total % 3600) / 60)).padStart(2, '0');
                const ss = String(total % 60).padStart(2, '0');
                return `${hh}:${mm}:${ss}`;
            }

            function parseTime(str) {
                const m = str.match(/^(\d+):(\d{1,2})(?::(\d{1,2}))?$/);
                if (!m) return null;
                const h = +m[1];
                const min = +m[2];
                const sec = m[3] !== undefined ? +m[3] : 0;
                if (min >= 60 || sec >= 60) return null;
                return (h * 3600 + min * 60 + sec) * 1000;
            }

            // ------------------ rendering ------------------
            function render() {
                timersEl.innerHTML = '';
                timers.forEach((t) => {
                    const row = document.createElement('div');
                    row.className = 'timer';
                    row.dataset.id = t.id;

                    // main button
                    const btn = document.createElement('button');
                    btn.className = 'toggle' + (t.running ? ' running' : '');
                    btn.textContent = t.label;
                    btn.title = 'Left-click: start/stop\nRight-click: rename';
                    btn.onclick = () => toggleTimer(t.id);
                    btn.oncontextmenu = (e) => {
                        e.preventDefault();
                        renameTimer(t.id);
                    };
                    row.appendChild(btn);

                    // time display
                    const span = document.createElement('span');
                    span.className = 'time';
                    span.textContent = formatMs(t.elapsed + (t.running ? Date.now() - t.lastStart : 0));
                    span.title = 'Click to edit time';
                    span.onclick = () => editTime(t.id);
                    row.appendChild(span);

                    // delete button
                    const del = document.createElement('button');
                    del.className = 'delete';
                    del.textContent = 'âœ•';
                    del.title = 'Delete';
                    del.onclick = () => deleteTimer(t.id);
                    row.appendChild(del);

                    timersEl.appendChild(row);
                });
            }

            // ------------------ core logic ------------------
            function toggleTimer(id) {
                const now = Date.now();
                const target = timers.find((x) => x.id === id);
                if (!target) return;

                if (target.running) {
                    // stop target
                    target.elapsed += now - target.lastStart;
                    target.running = false;
                    target.lastStart = null;
                } else {
                    // stop all others
                    timers.forEach((t) => {
                        if (t.running && t.id !== id) {
                            t.elapsed += now - t.lastStart;
                            t.running = false;
                            t.lastStart = null;
                        }
                    });
                    // start target
                    target.running = true;
                    target.lastStart = now;
                }
                saveTimers();
                render();
            }

            function editTime(id) {
                const t = timers.find((x) => x.id === id);
                if (!t) return;
                const current = formatMs(t.elapsed + (t.running ? Date.now() - t.lastStart : 0));
                const input = prompt('Enter time in hh:mm[:ss] format', current);
                if (input === null) return;
                const ms = parseTime(input.trim());
                if (ms === null) {
                    alert('Invalid format');
                    return;
                }
                t.elapsed = ms;
                if (t.running) t.lastStart = Date.now();
                saveTimers();
                render();
            }

            function renameTimer(id) {
                const t = timers.find((x) => x.id === id);
                if (!t) return;
                const input = prompt('Enter new name', t.label);
                if (input === null) return;
                const name = input.trim();
                if (!name) {
                    alert('Name cannot be empty');
                    return;
                }
                t.label = name;
                saveTimers();
                render();
            }

            function deleteTimer(id) {
                if (!confirm('Delete this timer?')) return;
                timers = timers.filter((x) => x.id !== id);
                saveTimers();
                render();
            }

            // ------------------ events ------------------
            addForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const label = newLabelInput.value.trim();
                if (!label) return;
                timers.push({
                    id: crypto.randomUUID(),
                    label,
                    elapsed: 0,
                    running: false,
                    lastStart: null,
                });
                newLabelInput.value = '';
                saveTimers();
                render();
            });

            resetAllBtn.onclick = () => {
                if (!confirm('Reset all timers?')) return;
                timers.forEach((t) => {
                    t.elapsed = 0;
                    t.running = false;
                    t.lastStart = null;
                });
                saveTimers();
                render();
            };

            // update display every second
            setInterval(() => {
                document.querySelectorAll('.timer').forEach((row) => {
                    const id = row.dataset.id;
                    const t = timers.find((x) => x.id === id);
                    if (!t) return;
                    row.querySelector('span.time').textContent = formatMs(t.elapsed + (t.running ? Date.now() - t.lastStart : 0));
                });
            }, 1000);

            // initial render
            render();
        })();
    </script>
</body>

</html>
